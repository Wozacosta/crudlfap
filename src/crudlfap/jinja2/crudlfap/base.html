<!DOCTYPE html>
{%- import 'crudlfap.html' as crudlfap %}
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="canonical" href="{{ view.url }}" />
    <link rel="icon" href="{{ static('favicon.ico') }}">

    <title>{% block title %}{{ view.title_html }}{% endblock %} {% if settings.SITE_TITLE %}- {{ crudlfap_site.title }}{% endif %}</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ static('viewer.css') }}" />

    <meta name="turbolinks-root" content="{{ crudlfap_site.views['home'].url }}">

    <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
    {% block bundles %}
      {% block style_bundle %}
      <link href="{{ static('crudlfap.css') }}" rel="stylesheet">
      {% endblock %}

      {% block script_bundle %}
      <script src="{{ static('crudlfap.js') }}" defer></script>
      {% endblock %}
    {% endblock %}

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Material+Icons&display=block" rel="stylesheet">

    {% block extra_style %}{% endblock %}

    <style>
    #main-modal .hide-in-modal {
        display: none;
    }
    </style>
    <script>
    function toggleSubmenu(subMenu) {
      showNext(subMenu)
      meta = subMenu.querySelector('[slot=meta]')
      meta.innerText = meta.innerText == 'keyboard_arrow_down' ? 'keyboard_arrow_up' : 'keyboard_arrow_down'
    }
    function listSubmenuClick(el) {
      if (this.event.target.tagName != 'MVC-LIST-ITEM') return
      var minX = this.event.target.getBoundingClientRect().width * 0.8
      // on list item itself, we'll let the normal A link behaviour if
      // not clicking on the last fifth of the box
      if (this.event.clientX < minX) return
      this.event.preventDefault()
      toggleSubmenu(this.event.target.parentElement)
    }
    function metaSubmenuClick(el) {
        this.event.preventDefault()
        toggleSubmenu(event.target.parentElement.parentElement)
    }
    function showNext(activator) {
      var sibling = activator.nextElementSibling
      if (!sibling) return false
      if (sibling.querySelector('[slot=meta]')) return false
      sibling.hidden = !sibling.hidden
      showNext(sibling)
    }
    </script>

  </head>

  <body class="{% block body_class %}{{ view.body_class|default('') }}{% endblock %}">
    <div id="main-loader" class="loader-container turbolinks-progress-bar">
      <style>
      mwc-circular-progress {
        --mdc-circular-progress-bar-color-1: #2196f3;
        --mdc-circular-progress-bar-color-2: #e91e63;
        --mdc-circular-progress-bar-color-3: #ffc107;
        --mdc-circular-progress-bar-color-4: #03dac5;
      }
      </style>
      <mwc-circular-progress-four-color indeterminate></mwc-circular-progress-four-color>
    </div>

    <mwc-drawer type="dismissible" id="drawer">
      <div class="drawer-content" style="overflow-y: scroll; height: 100%">
        {{ ryzom('crudlfap.components.menu.NavMenu', request) }}
      </div>
      <span slot="title">{{ request.user }}</span>
      <div slot="appContent">
          <mwc-top-app-bar-fixed style="--mdc-theme-primary: #fdfdfd;--mdc-theme-on-primary: var(--mdc-theme-text-primary-on-background, rgba(0, 0, 0, 0.87));">
          <mwc-icon-button
            slot="navigationIcon"
            icon="menu"
            id="menu-button"
            onclick="document.querySelector('#drawer').open = !document.querySelector('#drawer').open"
          ></mwc-icon-button>
          <div slot="title">
            {% block title_heading %}
              {{ getattr(view, 'title', str(request.user)) }}
            {% endblock %}
          </div>
          {{ ryzom('crudlfap.components.menu.TopMenu', request, view.menu_views) }}

          {% include 'crudlfap/_messages.html' %}
          {% block before_container %}{% endblock %}
          {% block content_open %}
          <div class="{{ view.body_class|default('') }}" id="modal-body-ajax">
          {% endblock %}
            {% if request.META.get('HTTP_X_MODAL') %}
            <!-- djwc-modules -->
            <mwc-dialog heading="{% if view.title_heading %}{{ view.title_heading }}{% endif %}">
            {% endif %}

            {% block form_open %}{% endblock %}
            {% block content %}{% block form %}{% endblock %}{% endblock %}
            {% block buttons %}{% endblock %}
            {% block form_close %}{% endblock %}

            {% if request.META.get('HTTP_X_MODAL') %}
            </mwc-dialog>
            {% endif %}
          {% block content_close %}
          </div>
          {% endblock %}
        </mwc-top-app-bar-fixed>
      </div>
    </mwc-drawer>

    <mwc-snackbar id="main-snack" labelText="An error occured">
      <mwc-icon-button icon="close" slot="dismiss"></mwc-icon-button>
    </mwc-snackbar>
    <div id="main-modal"><mwc-dialog></mwc-dialog></div>
  </body>
</html>
